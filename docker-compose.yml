version: '3'


volumes:
  esdata1:
    driver: local
   
networks:
  devnetwork:
    driver: bridge

services:
 rabbitmq:
  build: 
    context: ./docker/rabbitmq
  ports:
    - "5672:5672"
    - "15672:15672"
  networks:
    - devnetwork     
  volumes:
    - /opt/rabbitmq:/var/lib/rabbitmq
 chatterbot-engine:
  build:
    context: ./docker/chatterbot-engine
  environment:
    - RABBITMQ_USER=admin
    - RABBITMQ_PASSWORD=rabbitmqadmin
    - RABBITMQ_SERVER=rabbitmq
    - RABBITMQ_PORT=5672
    - RABBITMQ_EXCHANGE=bot_response_exchange
    - RABBITMQ_VIRTUALHOST=/
    - RABBITMQ_BOT_INCOMING_QUEUE=bot_request_queue
    - MONGODB_SERVER=db-mongo
    - MONGODB_USER=devroot
    - MONGODB_PASSWORD=devroot
    - MONGODB_PORT=27017
  networks:
    - devnetwork  
 ingestion-service:
  build:
    context: ./docker/ingestion-service
  environment:
    - RABBITMQ_USER=admin
    - RABBITMQ_PASSWORD=rabbitmqadmin
    - RABBITMQ_SERVER=rabbitmq
    - RABBITMQ_PORT=5672
    - RABBITMQ_EXCHANGE=ingestion_exchange
    - RABBITMQ_VIRTUALHOST=/
    - RABBITMQ_BOT_INCOMING_QUEUE=ingestion_queue
    - MONGODB_SERVER=db-mongo
    - MONGODB_USER=devroot
    - MONGODB_PASSWORD=devroot
    - MONGODB_PORT=27017
  networks:
    - devnetwork  
 db-mongo:
  image: mongo:latest
  ports:
    - "27017:27017"
    - "28017:27017"
  networks:
    - devnetwork
  environment:
    - MONGO_INITDB_ROOT_USERNAME=devroot
    - MONGO_INITDB_ROOT_PASSWORD=devroot
    - MONGO_INITDB_DATABASE=project        
 db-mongo-admin:
  image: mongo-express
  ports:
    - "8081:8081"
  networks:
    - devnetwork
  environment:
    - ME_CONFIG_OPTIONS_EDITORTHEME=ambiance
    - ME_CONFIG_MONGODB_SERVER=db-mongo
    - ME_CONFIG_MONGODB_PORT=27017
    - ME_CONFIG_MONGODB_ENABLE_ADMIN=false
    - ME_CONFIG_MONGODB_ADMINUSERNAME=devroot
    - ME_CONFIG_MONGODB_ADMINPASSWORD=devroot
  links:
    - db-mongo
 elasticsearch:
  image: docker.elastic.co/elasticsearch/elasticsearch:6.5.2
  container_name: elasticsearch
  environment:
    - cluster.name=docker-cluster
    - bootstrap.memory_lock=true
    - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  ulimits:
    memlock:
      soft: -1
      hard: -1
  volumes:
    - esdata1:/usr/share/elasticsearch/data
  ports:
    - 9200:9200
    - 9300:9300
  networks:
    - devnetwork

      
 